<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶„ì„ ê²°ê³¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f5f5f5; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* ì˜¤í–‰ ì»¬ëŸ¬ í´ë˜ìŠ¤ - ì´ˆë¡ìƒ‰(ëª©)ì˜ ì±„ë„ë¥¼ ë†’ì—¬ íšŒìƒ‰(ê¸ˆ)ê³¼ êµ¬ë¶„ë ¥ ê°•í™” */
        .text-ëª© { color: #00a86b; } .bg-ëª© { background-color: #00a86b; } /* ì„ ëª…í•œ ì—ë©”ë„ë“œ ê·¸ë¦° */
        .text-í™” { color: #e53e3e; } .bg-í™” { background-color: #e53e3e; } /* ì„ ëª…í•œ ë¹¨ê°• */
        .text-í†  { color: #b7791f; } .bg-í†  { background-color: #b7791f; } /* ê¹Šì´ ìˆëŠ” í™©í† ìƒ‰ */
        .text-ê¸ˆ { color: #718096; } .bg-ê¸ˆ { background-color: #718096; } /* ì°¨ë¶„í•œ ë¸”ë£¨ê·¸ë ˆì´(íšŒìƒ‰) */
        .text-ìˆ˜ { color: #1a202c; } .bg-ìˆ˜ { background-color: #1a202c; } /* ì§„í•œ ê²€ì • */
        
        /* í…Œì´ë¸” ì „ìš© ìŠ¤íƒ€ì¼ */
        .saju-table th, .saju-table td { border: 1px solid #e2e8f0; padding: 8px 4px; text-align: center; }
        .label-col { background-color: #f8fafc; font-weight: bold; font-size: 11px; color: #64748b; width: 60px; }
    </style>
</head>
<body class="max-w-md mx-auto bg-white min-h-screen pb-20 shadow-xl">

    <header class="p-6 border-b flex items-center gap-4">
        <div class="w-16 h-16 bg-pink-100 rounded-full flex items-center justify-center text-3xl">ğŸ±</div>
        <div>
            <h1 class="text-xl font-bold text-gray-800">{{ result.name }}ë‹˜</h1>
            <p class="text-sm font-medium text-gray-500">
                {{ result.ilju }} ì¼ì£¼
            </p>
        </div>
    </header>

    <div class="px-6 py-4 bg-gray-50 text-[11px] text-gray-400 leading-relaxed border-b">
        <p>ì–‘ {{ result.solar_display }} {{ result.gender_str }} {{ result.location_name }}</p>
        <p class="text-blue-400">ìŒ({{ result.lunar_type }}ë‹¬) {{ result.lunar_display }} {{ result.gender_str }} {{ result.location_name }}</p>
        <p class="text-black font-medium">
            <span class="text-red-400 font-bold">ì‹¤ì œ íƒœì–‘ì‹œ</span> {{ result.corrected_display }} 
            <span class="text-red-400">({{ result.location_name }} {{ result.lng_diff_str }})</span>
        </p>
    </div>

    <section class="p-4">
        <table class="w-full saju-table table-fixed border-collapse rounded-lg overflow-hidden shadow-sm">
            <thead>
                <tr class="bg-gray-50 text-[10px] text-gray-500">
                    <th class="label-col">êµ¬ë¶„</th>
                    <th>ìƒì‹œ</th>
                    <th>ìƒì¼</th>
                    <th>ìƒì›”</th>
                    <th>ìƒë…„</th>
                </tr>
            </thead>
            <tbody>
                <tr class="text-[15px] font-bold">
                    <td class="label-col">ì²œê°„</td>
                    {% for i in [3, 2, 1, 0] %}
                    {% set p = result.pillars[i] %}
                    <td class="text-{{ p.gan_elem }}">
                        <div class="flex flex-col items-center">
                            <div class="flex items-end">
                                <span class="text-2xl">{{ p.gan }}</span>
                                <span class="text-2xl ml-0.5 opacity-70">{{ p.gan_kor }}</span>
                            </div>
                            <span class="text-[9px] mt-1 font-bold">{{ p.gan_pol }}{{ p.gan_elem }}</span>
                        </div>
                    </td>
                    {% endfor %}
                </tr>
                <tr class="text-[11px]">
                    <td class="label-col">ì‹­ì„±</td>
                    {% for i in [3, 2, 1, 0] %}
                    {% set p = result.pillars[i] %}
                    <td class="text-{{ p.gan_elem }} font-bold">
                        {{ 'ë¹„ê²¬(ë³¸ì¸)' if i == 2 else p.t_gan }}
                    </td>
                    {% endfor %}
                </tr>

                <tr class="text-[15px] font-bold border-t-2">
                    <td class="label-col">ì§€ì§€</td>
                    {% for i in [3, 2, 1, 0] %}
                    {% set p = result.pillars[i] %}
                    <td class="text-{{ p.ji_elem }}">
                        <div class="flex flex-col items-center">
                            <div class="flex items-end">
                                <span class="text-2xl">{{ p.ji }}</span>
                                <span class="text-2xl ml-0.5 opacity-70">{{ p.ji_kor }}</span>
                            </div>
                            <span class="text-[9px] mt-1 font-bold">{{ p.ji_pol }}{{ p.ji_elem }}</span>
                        </div>
                    </td>
                    {% endfor %}
                </tr>
                <tr class="text-[11px]">
                    <td class="label-col">ì‹­ì„±</td>
                    {% for i in [3, 2, 1, 0] %}
                    {% set p = result.pillars[i] %}
                    <td class="text-{{ p.ji_elem }} font-bold">
                        {{ p.t_ji }}
                    </td>
                    {% endfor %}
                </tr>

                <tr class="text-[10px] text-gray-500">
                    <td class="label-col">ì§€ì¥ê°„</td>
                    {% for i in [3, 2, 1, 0] %}
                    <td>{{ result.pillars[i].jijangan | default('-') }}</td>
                    {% endfor %}
                </tr>
                <tr class="text-[10px] text-gray-500">
                    <td class="label-col">12ìš´ì„±</td>
                    {% for i in [3, 2, 1, 0] %}
                    <td>{{ result.pillars[i].unseong | default('-') }}</td>
                    {% endfor %}
                </tr>
                <tr class="text-[10px] text-gray-500">
                    <td class="label-col">12ì‹ ì‚´</td>
                    {% for i in [3, 2, 1, 0] %}
                    <td>{{ result.pillars[i].sinsal_12 }}</td>
                    {% endfor %}
                </tr>
            </tbody>
        </table>
    </section>

    <!--section class="px-5 mt-2">
        <div class="flex gap-2 overflow-x-auto no-scrollbar py-1">
            {% for tag in result.display_tags %}
            <span class="px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-[10px] whitespace-nowrap">#{{ tag }}</span>
            {% endfor %}
        </div>
    </section -->
    <section class="my-12 mx-4 overflow-hidden rounded-[32px] shadow-md border border-gray-200">
    <div class="bg-[#4a453f] p-5 flex justify-between items-center cursor-pointer select-none" onclick="toggleDetailedView()">
        <h2 class="text-base font-bold text-white ml-2">ì‚¬ì£¼ í’€ì´ ìì„¸íˆ ë³´ê¸°</h2>
        <span id="toggle-icon" class="text-white transition-transform duration-500 transform rotate-180 text-[10px] mr-2">â–²</span>
    </div>

    <div id="detailed-container" 
         class="bg-[#f0eee9] transition-all duration-500 ease-in-out max-h-[1200px] opacity-100 overflow-hidden">
        
        <div class="p-6 pb-12">
            <div class="flex flex-wrap gap-2 mb-8">
                {% set all_keys = ["ê¶ì„±", "ì²œê°„í•©", "ì§€ì§€ìœ¡í•©", "ì§€ì§€ì‚¼í•©", "ì§€ì§€ë°©í•©", "ì²œê°„ì¶©", "ì§€ì§€ì¶©", "ê³µë§", "í˜•", "íŒŒ", "í•´", "ì›ì§„"] %}
                {% for key in all_keys %}
                    <button onclick="highlightInteraction('{{ key }}')" 
                            id="btn-{{ key }}"
                            class="interaction-btn px-4 py-1.5 bg-white text-gray-700 rounded-full text-[11px] border border-gray-200 shadow-sm transition-all whitespace-nowrap active:scale-95">
                        {{ key }}
                    </button>
                {% endfor %}
            </div>

            <div id="interaction-desc" class="text-sm text-gray-700 mb-8 min-h-[40px] leading-relaxed">
                ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì—¬ ìƒì„¸ í’€ì´ë¥¼ í™•ì¸í•˜ì„¸ìš”.
            </div>

            <div class="grid grid-cols-4 gap-4 mb-2 text-center h-6">
                <div id="label-3" class="gungseong-label text-[10px] font-bold text-orange-600 opacity-0 transition-opacity duration-300">ìë…€/ë¯¸ë˜</div>
                <div id="label-2" class="gungseong-label text-[10px] font-bold text-orange-600 opacity-0 transition-opacity duration-300">ë‚˜/ë°°ìš°ì</div>
                <div id="label-1" class="gungseong-label text-[10px] font-bold text-orange-600 opacity-0 transition-opacity duration-300">ë¶€ëª¨/ì‚¬íšŒ</div>
                <div id="label-0" class="gungseong-label text-[10px] font-bold text-orange-600 opacity-0 transition-opacity duration-300">ì¡°ìƒ</div>
            </div>

            <div class="grid grid-cols-4 gap-4 mb-4">
                {% for i in [3, 2, 1, 0] %}
                <div class="flex flex-col gap-4">
                    <div id="gan-{{ i }}" class="saju-box h-14 bg-white rounded-xl flex items-center justify-center text-xl font-bold border border-gray-100 shadow-sm transition-all duration-300">
                        <span class="mr-1">{{ result.pillars[i].gan_kor }}</span>
                        <span class="text-lg opacity-80">{{ result.pillars[i].gan }}</span>
                    </div>
                    <div id="ji-{{ i }}" class="saju-box h-14 bg-white rounded-xl flex items-center justify-center text-xl font-bold border border-gray-100 shadow-sm transition-all duration-300">
                        <span class="mr-1">{{ result.pillars[i].ji_kor }}</span>
                        <span class="text-lg opacity-80">{{ result.pillars[i].ji }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

<section class="my-12 mx-4 p-8 bg-white rounded-[32px] shadow-sm border border-gray-100">
    <div class="flex items-center gap-2 mb-4">
        <h2 class="text-xl font-bold text-gray-800">ì‹ ì‚´ê³¼ ê¸¸ì„±</h2>
        <div class="w-5 h-5 bg-gray-600 rounded-full flex items-center justify-center text-white text-[10px]">
            <i class="fas fa-search"></i>
        </div>
    </div>

    <div class="text-sm text-gray-500 mb-8">
        {% set summary = [] %}
        {% for p in result.pillars %}{% for s in p.special %}{% if s not in summary %}{% set _ = summary.append(s) %}{% endif %}{% endfor %}{% endfor %}
        {{ summary | join(', ') }}
    </div>

    <div class="overflow-x-auto">
        <table class="w-full border-collapse border border-gray-100 text-center text-sm">
            <thead class="bg-gray-50 text-gray-500 text-[11px]">
                <tr>
                    <th class="border border-gray-100 py-2 w-16"></th>
                    <th>ìƒì‹œ</th><th>ìƒì¼</th><th>ìƒì›”</th><th>ìƒë…„</th>
                </tr>
            </thead>
            <tbody>
                <tr class="border-t border-gray-100">
                    <td class="bg-gray-50 text-[11px] text-gray-400">ì²œê°„</td>
                    {% for i in [3, 2, 1, 0] %}
                    <td class="py-4 text-xl font-bold text-{{ result.pillars[i].gan_elem }}">{{ result.pillars[i].gan_kor }}</td>
                    {% endfor %}
                </tr>
                <tr class="border-b border-gray-100">
                    <td class="bg-gray-50 text-[11px] text-gray-400">ê¸¸ì„±</td>
                    {% for i in [3, 2, 1, 0] %}
                    <td class="py-2 text-[11px] text-gray-500 leading-tight">
                        {% for s in result.pillars[i].sinsal_table_gan %}{{ s }}<br>{% endfor %}
                        {% if not result.pillars[i].sinsal_table_gan %}Ã—{% endif %}
                    </td>
                    {% endfor %}
                </tr>
                <tr>
                    <td class="bg-gray-50 text-[11px] text-gray-400">ì§€ì§€</td>
                    {% for i in [3, 2, 1, 0] %}
                    <td class="py-4 text-xl font-bold text-{{ result.pillars[i].ji_elem }}">{{ result.pillars[i].ji_kor }}</td>
                    {% endfor %}
                </tr>
                <tr>
                    <td class="bg-gray-50 text-[11px] text-gray-400">ê¸¸ì„±</td>
                    {% for i in [3, 2, 1, 0] %}
                    <td class="py-2 text-[11px] text-gray-500 leading-tight">
                        {% for s in result.pillars[i].sinsal_table_ji %}{{ s }}<br>{% endfor %}
                        {% if not result.pillars[i].sinsal_table_ji %}Ã—{% endif %}
                    </td>
                    {% endfor %}
                </tr>
            </tbody>
        </table>
    </div>
</section>

<section class="my-12 mx-4 p-8 bg-white rounded-[32px] shadow-sm border border-gray-100">
    <h2 class="text-xl font-bold text-gray-800 mb-6">ì˜¤í–‰ê³¼ ì‹­ì„± ë¶„ì„</h2>
    
    <div class="flex flex-col gap-2 mb-10 text-xs text-gray-400">
    <label class="flex items-center gap-2 cursor-pointer">
        <input type="checkbox" id="hap-check" onchange="updateAnalysis()" class="rounded-sm border-gray-300"> 
        í•©ì— ë”°ë¥¸ ì˜¤í–‰ ë³€í™” ì ìš© 
        <span class="text-[10px] bg-gray-100 p-1 rounded-full text-gray-400">?</span>
    </label>
    <label class="flex items-center gap-2 cursor-pointer">
        <input type="checkbox" id="johoo-check" onchange="updateAnalysis()" class="rounded-sm border-gray-300"> 
        ì¡°í›„ì™€ ê¶ì„± ë³´ì •ê°’ ì ìš© 
        <span class="text-[10px] bg-gray-100 p-1 rounded-full text-gray-400">?</span>
    </label>
</div>

<input type="hidden" id="birth-val" value="{{ result.birth }}">
<input type="hidden" id="gender-val" value="{{ result.gender }}">
<input type="hidden" id="location-val" value="{{ result.location_name }}">

   <div class="max-w-5xl mx-auto px-4 py-8">
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-12 mb-12 items-center">
        
        <div class="flex flex-col items-center">
            <h3 class="text-sm font-bold text-gray-700 mb-6">ëŒ€í‘œ ì˜¤í–‰ (ë³¸ì§ˆ)</h3>
            <div class="relative w-full max-w-[240px] aspect-square">
                <canvas id="elementDoughnutChart"></canvas>
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center pointer-events-none w-full">
                    <div class="text-2xl font-extrabold
                        {% if result.representative_elem == 'ëª©' %}text-green-600
                        {% elif result.representative_elem == 'í™”' %}text-red-600
                        {% elif result.representative_elem == 'í† ' %}text-yellow-700
                        {% elif result.representative_elem == 'ê¸ˆ' %}text-gray-500
                        {% elif result.representative_elem == 'ìˆ˜' %}text-blue-600{% endif %}">
                        {{ result.representative_elem }}
                        <span class="text-base">
                            {% if result.representative_elem == 'ëª©' %}(æœ¨)
                            {% elif result.representative_elem == 'í™”' %}(ç«)
                            {% elif result.representative_elem == 'í† ' %}(åœŸ)
                            {% elif result.representative_elem == 'ê¸ˆ' %}(é‡‘)
                            {% elif result.representative_elem == 'ìˆ˜' %}(æ°´){% endif %}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex flex-col items-center">
            <h3 class="text-sm font-bold text-gray-700 mb-6">ëŒ€í‘œ ì„±í–¥ (ê°€ì¥ ê°•í•œ)</h3>
            <div class="relative w-full max-w-[240px] aspect-square">
                <canvas id="tengodDoughnutChart"></canvas>
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center pointer-events-none w-full">
                    <div class="text-xl font-extrabold text-gray-700">
                        {{ result.representative_tendency }}
                    </div>
                    <div class="text-[10px] text-gray-400 mt-1 font-bold">
                        {% if 'ë¹„ê²¬' in result.representative_tendency %}(æ¯”è‚©)
                        {% elif 'ê²ì¬' in result.representative_tendency %}(åŠ«è²¡)
                        {% elif 'ì‹ì‹ ' in result.representative_tendency %}(é£Ÿç¥)
                        {% elif 'ìƒê´€' in result.representative_tendency %}(å‚·å®˜)
                        {% elif 'í¸ì¬' in result.representative_tendency %}(åè²¡)
                        {% elif 'ì •ì¬' in result.representative_tendency %}(æ­£è²¡)
                        {% elif 'í¸ê´€' in result.representative_tendency %}(åå®˜)
                        {% elif 'ì •ê´€' in result.representative_tendency %}(æ­£å®˜)
                        {% elif 'í¸ì¸' in result.representative_tendency %}(åå°)
                        {% elif 'ì •ì¸' in result.representative_tendency %}(æ­£å°){% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>



    
<div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
    <div class="grid grid-cols-2 bg-gray-50 border-b border-gray-100">
        <div class="py-3 text-center text-sm font-bold text-gray-600 border-r border-gray-100">ì˜¤í–‰</div>
        <div class="py-3 text-center text-sm font-bold text-gray-600">ì‹­ì„±</div>
    </div>

    <div class="divide-y divide-gray-100">
        {% for row in result.forestellar_analysis %}
        <div class="grid grid-cols-2">
            <div class="p-4 border-r border-gray-100 flex flex-col justify-center items-center">
                <div class="text-base font-bold mb-1
                    {% if row.elem_name == 'ëª©' %}text-green-600
                    {% elif row.elem_name == 'í™”' %}text-red-600
                    {% elif row.elem_name == 'í† ' %}text-yellow-700
                    {% elif row.elem_name == 'ê¸ˆ' %}text-gray-500
                    {% elif row.elem_name == 'ìˆ˜' %}text-blue-600{% endif %}">
                    {{ row.elem_name }}
                </div>
                <div class="text-xs text-gray-500">
                    {{ row.score }} <span class="ml-1 px-1.5 py-0.5 rounded-md bg-gray-100 text-[10px]">{{ row.status }}</span>
                </div>
            </div>

            <div class="p-4 flex flex-col justify-center space-y-2 text-xs">
                <div class="flex justify-between items-center h-5">
                    <span class="text-gray-700">{{ row.tg1_name }}</span>
                    <span class="font-mono text-gray-400">{{ row.tg1_ratio }}</span>
                </div>
                <div class="flex justify-between items-center h-5 border-t border-dotted border-gray-200 pt-1">
                    <span class="text-gray-700">{{ row.tg2_name }}</span>
                    <span class="font-mono text-gray-400">{{ row.tg2_ratio }}</span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
</section>
<section class="p-6 bg-white rounded-3xl shadow-sm">

    <div class="mt-8 mb-4 px-2 text-left">
        <h3 class="text-lg font-bold text-gray-800">ë‚˜ì˜ ì˜¤í–‰: {{ result.me_elem }}{{ result.me }}</h3>
        <div class="flex flex-col mt-2 space-y-1">
            <div class="flex items-center text-xs font-semibold text-gray-500">
                <span class="text-[#428BFF] mr-2">â”</span> ìƒ(ç”Ÿ)
            </div>
            <div class="flex items-center text-xs font-semibold text-gray-500">
                <span class="text-[#E85E5E] mr-2">â”</span> ê·¹(å‰‹)
            </div>
        </div>
    </div>

    <div class="relative mx-auto my-8" style="width: 100%; max-width: 480px; aspect-ratio: 256 / 250;">
        
        <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 256 250" fill="none" class="absolute inset-0 z-10 pointer-events-none">
            <path d="M95.1846 64.5709L83.6958 65.7286L90.4427 75.0994L95.1846 64.5709ZM76.2921 79.4058L88.4651 70.6412L87.2965 69.0181L75.1235 77.7827L76.2921 79.4058Z" fill="#428BFF"></path>
            <path d="M185.585 75.8724L180.762 65.3809L174.087 74.8036L185.585 75.8724ZM165.422 62.816L177.662 71.4863L178.818 69.8542L166.578 61.184L165.422 62.816Z" fill="#428BFF"></path>
            <path d="M196.411 168.768L205.05 161.107L194.096 157.456L196.411 168.768ZM203.051 145.684L198.308 159.914L200.205 160.546L204.949 146.316L203.051 145.684Z" fill="#428BFF"></path>
            <path d="M116 208.5L126 214.274L126 202.726L116 208.5ZM140 207.5L125 207.5L125 209.5L140 209.5L140 207.5Z" fill="#428BFF"></path>
            <path d="M52.1034 144.666L49.6925 155.959L60.6775 152.4L52.1034 144.666ZM60.4512 167.192L55.8282 152.92L53.9255 153.537L58.5486 167.808L60.4512 167.192Z" fill="#428BFF"></path>

            <path d="M99.2981 170.944C99.1359 171.472 99.4324 172.031 99.9603 172.193C100.488 172.356 101.048 172.059 101.21 171.531L99.2981 170.944ZM126.108 87.0952L117.652 94.9584L128.69 98.3499L126.108 87.0952ZM101.21 171.531L124.42 95.992L122.509 95.4046L99.2981 170.944L101.21 171.531Z" fill="#E85E5E"></path>
            <path d="M157.192 169.365L159.654 158.084L148.653 161.593L157.192 169.365ZM129.489 85.8024L153.505 161.095L155.41 160.487L131.395 85.1947L129.489 85.8024Z" fill="#E85E5E"></path>
            <path d="M82.4506 120.765L87.2592 131.263L93.9466 121.849L82.4506 120.765ZM154.775 170.917L90.3668 125.162L89.2085 126.792L153.617 172.548L154.775 170.917Z" fill="#E85E5E"></path>
            <path d="M172 118L162 112.226V123.774L172 118ZM84 119H163V117H84V119Z" fill="#E85E5E"></path>
            <path d="M102.234 174.283L113.7 172.918L106.785 163.67L102.234 174.283ZM172.116 120.778L108.843 168.092L110.04 169.694L173.313 122.38L172.116 120.778Z" fill="#E85E5E"></path>
        </svg>

        {% for group in result.relation_groups %}
        <div class="node-item node-pos-{{ loop.index0 }} absolute flex flex-col items-center justify-center bg-white border border-[#B8B2AC] rounded-full shadow-sm z-20 overflow-hidden transition-transform active:scale-95"
             style="width: 100px; height: 100px; transform: translate(-50%, -50%);">
            
            <span class="text-[14px] font-bold text-[#524C46] mb-0.5">{{ group.elem_name }}({{ group.group_name }})</span>
            <span class="text-[18px] font-black text-[#524C46] leading-none">{{ group.score }}</span>
            
            <div class="absolute bottom-0 left-0 w-full opacity-60 -z-10 transition-all duration-1000"
                 style="height: {{ group.percent }}%; background-color: {% if group.elem_name == 'ëª©' %}#99DFF9{% elif group.elem_name == 'í™”' %}#FDAAAA{% elif group.elem_name == 'í† ' %}#FFD36E{% elif group.elem_name == 'ê¸ˆ' %}#DAD6D2{% else %}#B1B0BB{% endif %};">
            </div>
        </div>
        {% endfor %}
    </div>

    <style>
        /* 256x250 ì¢Œí‘œê³„ ê¸°ë°˜ ë…¸ë“œ ì •ë°€ ë°°ì¹˜ */
        .node-pos-0 { top: 16%; left: 50.4%; }   /* ëª© */
        .node-pos-1 { top: 42%; left: 84.4%; }   /* í™” */
        .node-pos-2 { top: 83.2%; left: 71.5%; } /* í†  */
        .node-pos-3 { top: 83.2%; left: 28.9%; } /* ê¸ˆ */
        .node-pos-4 { top: 42%; left: 15.6%; }   /* ìˆ˜ */

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜•: ì› í¬ê¸° 80pxë¡œ ì¡°ì • */
        @media (max-width: 640px) {
            .node-item { width: 80px !important; height: 80px !important; }
            .node-item span:first-child { font-size: 11px; }
            .node-item span:last-child { font-size: 14px; }
        }
    </style>

</section>

    <section class="p-6">
        <h2 class="text-lg font-bold mb-4">ì‹ ê°•/ì‹ ì•½ ë¶„ì„</h2>
        <div class="bg-gray-50 p-6 rounded-[28px] border border-gray-100">
            <p class="text-sm text-gray-600">
                {{ result.name }}ë‹˜ì€ <span class="font-bold text-black">{{ result.status }}({{ result.power }})</span> ì‚¬ì£¼ì…ë‹ˆë‹¤.
            </p>
            <div class="relative h-2 bg-gray-200 rounded-full mt-8">
                <div class="absolute top-1/2 -translate-y-1/2 w-4 h-4 bg-gray-800 rounded-full border-2 border-white shadow" 
                     style="left: {{ result.power }}%;"></div>
            </div>
        </div>
    </section>
<div class="w-full border border-gray-200 rounded-[12px] p-5 bg-white shadow-sm">
    <div class="flex items-center gap-6">
        
        {% if result.yongsin_detail.johoo_name %}
        <div class="flex items-center">
            <span class="text-[#e53e3e] font-bold text-[17px]">
                {{ result.yongsin_detail.johoo_name.split('(')[0] }}
            </span>
            <span class="text-gray-500 text-[15px] ml-1">(ì¡°í›„ìš©ì‹ )</span>
        </div>
        {% endif %}

        <div class="flex items-center">
            <span class="text-[#e53e3e] font-bold text-[17px]">
                {{ result.yongsin_detail.main_yongsin.split('(')[0] }}
            </span>
            <span class="text-gray-500 text-[15px] ml-1">(ì–µë¶€ìš©ì‹ )</span>
        </div>
        
    </div>

    {% if result.yongsin_detail.johoo_desc %}
    <div class="mt-4 pt-4 border-t border-gray-50 text-[12px] text-gray-400">
        {{ result.yongsin_detail.johoo_desc }}
    </div>
    {% endif %}
</div>
    
    <section class="my-12 mx-4">
    <div class="flex items-center justify-between mb-6 px-2">
        <h2 class="text-xl font-bold text-gray-800 tracking-tight">ëŒ€ìš´</h2>
        <span class="text-sm text-gray-400">ëŒ€ìš´ìˆ˜ {{ result.daeun_num }}</span>
    </div>
    
    <div class="flex gap-1.5 overflow-x-auto no-scrollbar pb-6 px-1">
        {% for d in result.daeun_list | reverse %}
        <div class="daeun-item-box flex-shrink-0 w-[58px] flex flex-col items-center cursor-pointer" 
             onclick="loadYeonun('{{ result.birth[:4] }}', {{ d.start_age }}, '{{ result.me }}', '{{ result.me }}', this)">
            
            <div class="text-[13px] font-bold text-gray-600 mb-1">{{ d.start_age }}</div>
            
            <div class="text-[11px] text-gray-500 mb-2 h-4 flex items-center justify-center">{{ d.t_gan }}</div>
            
            <div class="ganzi-container w-full flex flex-col gap-1.5 rounded-lg transition-all
                {{ 'ring-2 ring-gray-800 ring-offset-1' if result.current_trace.daeun.start_age == d.start_age }}">
                
                <div class="relative w-full aspect-square rounded-lg flex items-center justify-center shadow-sm border border-black/5 
                    bg-{{ d.gan_elem }} {% if d.gan_elem == 'ê¸ˆ' %}border-gray-200{% endif %}">
                    <span class="text-[19px] font-bold {% if d.gan_elem == 'ê¸ˆ' %}text-gray-800{% else %}text-white{% endif %}">
                        {{ d.gan_kor }}
                    </span>
                    <span class="absolute bottom-0.5 right-1 text-[9px] font-medium {% if d.gan_elem == 'ê¸ˆ' %}text-gray-400{% else %}text-white/70{% endif %}">
                        {{ d.gan }}
                    </span>
                </div>
                
                <div class="relative w-full aspect-square rounded-lg flex items-center justify-center shadow-sm border border-black/5 
                    bg-{{ d.ji_elem }} {% if d.ji_elem == 'ê¸ˆ' %}border-gray-200{% endif %}">
                    <span class="text-[19px] font-bold {% if d.ji_elem == 'ê¸ˆ' %}text-gray-800{% else %}text-white{% endif %}">
                        {{ d.ji_kor }}
                    </span>
                    <span class="absolute bottom-0.5 right-1 text-[9px] font-medium {% if d.ji_elem == 'ê¸ˆ' %}text-gray-400{% else %}text-white/70{% endif %}">
                        {{ d.ji }}
                    </span>
                </div>
            </div>
            
            <div class="mt-2.5 text-center flex flex-col gap-0.5 leading-tight">
                <div class="text-[11px] text-gray-500 font-medium">{{ d.t_ji }}</div>
                <div class="text-[11px] text-gray-400">{{ d.unseong }}</div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
<section id="yeonun-section" class="my-12 mx-4 opacity-100 transition-opacity duration-300">
    <div class="flex items-center justify-between mb-6 px-2">
        <h2 class="text-xl font-bold text-gray-800 tracking-tight">ì—°ìš´</h2>
        <span id="selected-daeun-text" class="text-sm text-gray-400">ë‚˜ì´ë³„ ì„¸ìš´</span>
    </div>
    
    <div id="yeonun-container" class="flex gap-1.5 overflow-x-auto no-scrollbar pb-6 px-1">
        {% for y in result.initial_yeonun %}
        <div class="yeonun-item-box flex-shrink-0 w-[58px] flex flex-col items-center cursor-pointer"
             onclick="loadWolun('{{ y.year }}', '{{ result.me }}', '{{ result.me }}', this)">
            
            <div class="text-[12px] font-bold text-gray-600 mb-1">{{ y.year }}</div>
            <div class="text-[10px] text-gray-500 mb-2 h-4">{{ y.t_gan }}</div>
            
            <div class="ganzi-container w-full flex flex-col gap-1.5 rounded-lg transition-all">
                <div class="relative w-full aspect-square rounded-lg flex items-center justify-center shadow-sm border border-black/5 bg-{{ y.gan_elem }}">
                    <span class="text-[19px] font-bold {% if y.gan_elem == 'ê¸ˆ' %}text-gray-800{% else %}text-white{% endif %}">{{ y.gan_kor }}</span>
                    <span class="absolute bottom-0.5 right-1 text-[9px] {% if y.gan_elem == 'ê¸ˆ' %}text-gray-400{% else %}text-white/70{% endif %}">{{ y.ganzi[0] }}</span>
                </div>
                <div class="relative w-full aspect-square rounded-lg flex items-center justify-center shadow-sm border border-black/5 bg-{{ y.ji_elem }}">
                    <span class="text-[19px] font-bold {% if y.ji_elem == 'ê¸ˆ' %}text-gray-800{% else %}text-white{% endif %}">{{ y.ji_kor }}</span>
                    <span class="absolute bottom-0.5 right-1 text-[9px] {% if y.ji_elem == 'ê¸ˆ' %}text-gray-400{% else %}text-white/70{% endif %}">{{ y.ganzi[1] }}</span>
                </div>
            </div>
            
            <div class="mt-2.5 text-center">
                <div class="text-[10px] text-gray-500">{{ y.t_ji }}</div>
                <div class="text-[10px] text-gray-400">{{ y.unseong }}</div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
<section class="my-12 mx-4">
    <h2 class="text-xl font-bold text-gray-800 mb-6 px-2">ì›”ìš´</h2>
    <div id="wolun-container" class="flex gap-1.5 overflow-x-auto no-scrollbar pb-6 px-1">
        {% for w in result.initial_wolun %}
        <div class="flex-shrink-0 w-[58px] flex flex-col items-center">
            <div class="text-[12px] font-bold text-gray-600 mb-1">{{ w.month }}ì›”</div>
            <div class="text-[10px] text-gray-500 mb-2 h-4">{{ w.t_gan }}</div>
            <div class="w-full flex flex-col gap-1.5">
                <div class="relative w-full aspect-square rounded-lg flex items-center justify-center shadow-sm border border-black/5 bg-{{ w.gan_elem }}">
                    <span class="text-[19px] font-bold {% if w.gan_elem == 'ê¸ˆ' %}text-gray-800{% else %}text-white{% endif %}">{{ w.gan_kor }}</span>
                    <span class="absolute bottom-0.5 right-1 text-[9px] {% if w.gan_elem == 'ê¸ˆ' %}text-gray-400{% else %}text-white/70{% endif %}">{{ w.ganzi[0] }}</span>
                </div>
                <div class="relative w-full aspect-square rounded-lg flex items-center justify-center shadow-sm border border-black/5 bg-{{ w.ji_elem }}">
                    <span class="text-[19px] font-bold {% if w.ji_elem == 'ê¸ˆ' %}text-gray-800{% else %}text-white{% endif %}">{{ w.ji_kor }}</span>
                    <span class="absolute bottom-0.5 right-1 text-[9px] {% if w.ji_elem == 'ê¸ˆ' %}text-gray-400{% else %}text-white/70{% endif %}">{{ w.ganzi[1] }}</span>
                </div>
            </div>
            <div class="mt-2.5 text-center leading-tight">
                <div class="text-[10px] text-gray-500">{{ w.t_ji }}</div>
                <div class="text-[10px] text-gray-400">{{ w.unseong }}</div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
<style>
    /* í¬ìŠ¤í…”ëŸ¬ ìŠ¤íƒ€ì¼ ì˜¤í–‰ ì»¬ëŸ¬ ì •ì˜ */
    .bg-ëª© { background-color: #78aed3; } /* ì²­ìƒ‰ */
    .bg-í™” { background-color: #e56d6d; } /* ì ìƒ‰ */
    .bg-í†  { background-color: #f6b352; } /* í™©ìƒ‰ */
    .bg-ê¸ˆ { background-color: #ffffff; } /* ë°±ìƒ‰ */
    .bg-ìˆ˜ { background-color: #9ba3af; } /* í‘ìƒ‰(íšŒìƒ‰) */

    /* ê°€ë¡œ ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
</style>
<section class="my-12 mx-4 p-6 bg-white rounded-[32px] shadow-sm border border-gray-100">
    <h2 class="text-xl font-bold text-gray-800 mb-6">ì¼ì§„ ë‹¬ë ¥</h2>
    
    <div class="flex items-center justify-center gap-8 mb-4">
        <button onclick="changeMonth(-1)" class="text-gray-400 hover:text-black text-xl transition-colors">â—€</button>
        
        <div class="text-center">
            <div class="flex items-center justify-center gap-1 text-lg font-bold text-gray-800">
        <select id="cal-year-select" onchange="handleDateSelect()" class="bg-transparent appearance-none cursor-pointer focus:outline-none hover:text-indigo-600 transition-colors">
            </select>
        <span>ë…„</span>
        <select id="cal-month-select" onchange="handleDateSelect()" class="bg-transparent appearance-none cursor-pointer focus:outline-none ml-1 hover:text-indigo-600 transition-colors">
            {% for m in range(1, 13) %}
            <option value="{{ m }}">{{ m }}</option>
            {% endfor %}
        </select>
        <span>ì›”</span>
    </div>
            
            <p id="cal-saju-header" class="text-[11px] text-gray-500 font-medium mt-1">
                {{ result.saju_header }}
            </p>
        </div>
        
        <button onclick="changeMonth(1)" class="text-gray-400 hover:text-black text-xl transition-colors">â–¶</button>
    </div>

    <div class="grid grid-cols-7 gap-1 mb-2 text-center text-[11px] font-bold text-gray-400">
        <div class="text-red-400">æ—¥</div><div>æœˆ</div><div>ç«</div><div>æ°´</div><div>æœ¨</div><div>é‡‘</div><div class="text-blue-400">åœŸ</div>
    </div>

    <div id="calendar-grid" class="grid grid-cols-7 gap-1 min-h-[400px]">
        </div>
</section>

    <nav class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t flex justify-around py-3 text-[10px] text-gray-400 z-50">
        <div class="text-center text-black font-bold">ğŸ”® ì‚¬ì£¼ë¶„ì„</div>
        <div class="text-center">ğŸ€ í–‰ìš´ì •ë³´</div>
        <div class="text-center">ğŸ“… ì¼ì§„ë‹¬ë ¥</div>
    </nav>

</body>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
<script>
    // ì•„ì½”ë””ì–¸ í† ê¸€ ë¡œì§
    function toggleDetailedView() {
        const container = document.getElementById('detailed-container');
        const icon = document.getElementById('toggle-icon');
        
        // ì´ˆê¸° ìƒíƒœ ì„¤ì • (JSë¡œ ì œì–´í•˜ê¸° ìœ„í•´ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ í™•ì¸)
        if (container.style.maxHeight === "0px") {
            container.style.maxHeight = "1200px";
            container.style.opacity = "1";
            icon.style.transform = "rotate(180deg)";
        } else {
            container.style.maxHeight = "0px";
            container.style.opacity = "0";
            icon.style.transform = "rotate(0deg)";
        }
    }

    // ê´€ê³„ ê°•ì¡° ë¡œì§
    const interactions = {{ result.interactions | tojson }};

    function highlightInteraction(category) {
        // ëª¨ë“  ìƒíƒœ ì´ˆê¸°í™”
        document.querySelectorAll('.saju-box').forEach(box => {
            box.classList.remove('bg-[#ffcc80]', 'border-[#ffa726]', 'scale-105', 'z-10');
            box.classList.add('bg-white', 'border-gray-100');
        });
        document.querySelectorAll('.interaction-btn').forEach(btn => {
            btn.classList.remove('bg-gray-800', 'text-white', 'border-gray-800');
            btn.classList.add('bg-white', 'text-gray-700', 'border-gray-200');
        });
        document.querySelectorAll('.gungseong-label').forEach(label => label.classList.add('opacity-0'));

        // ë²„íŠ¼ í™œì„±í™”
        const activeBtn = document.getElementById(`btn-${category}`);
        if (activeBtn) {
            activeBtn.classList.remove('bg-white', 'text-gray-700');
            activeBtn.classList.add('bg-gray-800', 'text-white', 'border-gray-800');
        }

        const descBox = document.getElementById('interaction-desc');

        // ê¶ì„± ëª¨ë“œ
        if (category === "ê¶ì„±") {
            descBox.innerHTML = "ê° ìë¦¬ëŠ” <b>ë…„(ì¡°ìƒ), ì›”(ë¶€ëª¨/ì‚¬íšŒ), ì¼(ë‚˜/ë°°ìš°ì), ì‹œ(ìë…€/ë¯¸ë˜)</b>ë¥¼ ìƒì§•í•©ë‹ˆë‹¤.";
            document.querySelectorAll('.gungseong-label').forEach(label => label.classList.remove('opacity-0'));
            return;
        }

        // ê´€ê³„ ê°•ì¡° ëª¨ë“œ
        const items = interactions[category] || [];
        if (items.length > 0) {
            let descText = "";
            items.forEach((item, index) => {
                descText += (index > 0 ? ", " : "") + `<span class="font-bold text-orange-600">${item.name}</span>`;
                item.subs.forEach(idx => {
                    const targetId = category.includes('ì²œê°„') ? `gan-${idx}` : `ji-${idx}`;
                    const box = document.getElementById(targetId);
                    if (box) {
                        box.classList.remove('bg-white');
                        box.classList.add('bg-[#ffcc80]', 'border-[#ffa726]', 'scale-105', 'z-10');
                    }
                });
            });
            descBox.innerHTML = `${category}ì— ${descText}ì´(ê°€) ìˆì–´ìš”.`;
        } else {
            descBox.innerHTML = `<span class="text-gray-400">${category} ê´€ê³„ê°€ ì´ ì‚¬ì£¼ì—ëŠ” ì—†ìŠµë‹ˆë‹¤.</span>`;
        }
    }
// Chart.js í”ŒëŸ¬ê·¸ì¸ ë“±ë¡
    Chart.register(ChartDataLabels);

    const commonOptions = {
        responsive: true,
        maintainAspectRatio: true, // ì •ì‚¬ê°í˜• ìœ ì§€
        plugins: {
            legend: { display: false },
            tooltip: { enabled: false },
            datalabels: { display: false }
        },
        cutout: '78%', // ë„ë„› ë‘ê»˜ë¥¼ ë” ì–‡ê²Œ í•˜ì—¬ ì„¸ë ¨ë˜ê²Œ ì¡°ì •
        animation: { animateScale: true, animateRotate: true }
    };

    // 1. ì˜¤í–‰ ì°¨íŠ¸
    const elementScores = {{ result.scores | tojson }};
    const elementLabels = ['ëª©', 'í™”', 'í† ', 'ê¸ˆ', 'ìˆ˜'];
    const elementColors = { 'ëª©': '#16a34a', 'í™”': '#dc2626', 'í† ': '#a16207', 'ê¸ˆ': '#6b7280', 'ìˆ˜': '#2563eb' };

    new Chart(document.getElementById('elementDoughnutChart'), {
        type: 'doughnut',
        data: {
            labels: elementLabels,
            datasets: [{
                data: elementLabels.map(l => elementScores[l] || 0),
                backgroundColor: elementLabels.map(l => elementColors[l]),
                borderWidth: 0
            }]
        },
        options: commonOptions
    });

    // 2. ì‹­ì„± ì°¨íŠ¸
    const tengodAnalysis = {{ result.tengod_analysis | tojson }};
    const tengodOrder = ["ë¹„ê²¬", "ê²ì¬", "ì‹ì‹ ", "ìƒê´€", "í¸ì¬", "ì •ì¬", "í¸ê´€", "ì •ê´€", "í¸ì¸", "ì •ì¸"];
    const tengodColors = [
        '#4ade80', '#22c55e', '#f87171', '#ef4444', '#facc15', 
        '#eab308', '#9ca3af', '#6b7280', '#60a5fa', '#3b82f6'
    ];
    const tgMap = {};
    tengodAnalysis.forEach(i => tgMap[i.name] = parseFloat(i.ratio.replace('%', '')) || 0);

    new Chart(document.getElementById('tengodDoughnutChart'), {
        type: 'doughnut',
        data: {
            labels: tengodOrder,
            datasets: [{
                data: tengodOrder.map(l => tgMap[l] || 0),
                backgroundColor: tengodColors,
                borderWidth: 0
            }]
        },
        options: commonOptions
    });
/**
 * ëŒ€ìš´ í´ë¦­ ì‹œ í˜¸ì¶œ: ì—°ìš´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³  ì›”ìš´ ì—°ê²° ê³ ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
 */
async function loadYeonun(birthYear, startAge, meGan, meHj, element) {
    // ëŒ€ìš´ ë°•ìŠ¤ í•˜ì´ë¼ì´íŠ¸
    document.querySelectorAll('.daeun-item-box .ganzi-container').forEach(box => {
        box.classList.remove('ring-2', 'ring-gray-800', 'ring-offset-1');
    });
    const targetBox = element.querySelector('.ganzi-container');
    if (targetBox) targetBox.classList.add('ring-2', 'ring-gray-800', 'ring-offset-1');

    try {
        const url = `/api/yeonun?birth_year=${birthYear}&start_age=${startAge}&me_gan=${meGan}&me_hj=${meHj}`;
        const response = await fetch(url);
        const yeonunData = await response.json();

        // 1. ì—°ìš´ ë¦¬ìŠ¤íŠ¸ ê·¸ë¦¬ê¸° (ë‚´ë¦¼ì°¨ìˆœ ë°ì´í„° ë°˜ì˜)
        renderYeonunList(yeonunData, meGan, meHj);

        // 2. [í•µì‹¬] ê°€ì¥ ì˜¤ë¥¸ìª½(ìµœì†Œ ì—°ë„) ìë™ ì„ íƒ ë¡œì§
        if (yeonunData.length > 0) {
            // ë°ì´í„°ì˜ ë§ˆì§€ë§‰ ìš”ì†Œê°€ ê°€ì¥ ì‘ì€ ì—°ë„ì„
            const earliestYearData = yeonunData[yeonunData.length - 1]; 
            
            // í™”ë©´ìƒì— ê·¸ë ¤ì§„ ì—°ìš´ ë°•ìŠ¤ë“¤ ì¤‘ ë§ˆì§€ë§‰ ìš”ì†Œë¥¼ ì°¾ìŒ
            const allYeonunBoxes = document.querySelectorAll('#yeonun-container .yeonun-item-box');
            const lastYeonunElement = allYeonunBoxes[allYeonunBoxes.length - 1];
            
            if (lastYeonunElement) {
                // ê°€ì¥ ì˜¤ë¥¸ìª½ ì—°ìš´ ë°•ìŠ¤ë¥¼ í™œì„±í™”í•˜ê³  ì›”ìš´ ë¡œë“œ
                loadWolun(earliestYearData.year, meGan, meHj, lastYeonunElement);
            }
        }
    } catch (error) {
        console.error("ì—°ìš´/ì›”ìš´ ì—°ì‡„ ë¡œë”© ì‹¤íŒ¨:", error);
    }
}

/**
 * ì—°ìš´ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥: ê° ì—°ë„ ë°•ìŠ¤ì— ì›”ìš´ í˜¸ì¶œ ì´ë²¤íŠ¸ë¥¼ ì‚½ì…í•©ë‹ˆë‹¤.
 */
function renderYeonunList(yeonunData, meGan, meHj) {
    const container = document.getElementById('yeonun-container');
    if (!container) return;

    container.innerHTML = yeonunData.map(y => `
        <div class="yeonun-item-box flex-shrink-0 w-[58px] flex flex-col items-center cursor-pointer"
             onclick="loadWolun('${y.year}', '${meGan}', '${meHj}', this)">
            <div class="text-[12px] font-bold text-gray-600 mb-1">${y.year}</div>
            <div class="text-[10px] text-gray-500 mb-2 h-4 flex items-center justify-center">${y.t_gan}</div>
            <div class="ganzi-container w-full flex flex-col gap-1.5 rounded-lg transition-all">
                <div class="relative w-full aspect-square rounded-lg flex items-center justify-center shadow-sm border border-black/5 bg-${y.gan_elem} ${y.gan_elem === 'ê¸ˆ' ? 'border-gray-200' : ''}">
                    <span class="text-[19px] font-bold ${y.gan_elem === 'ê¸ˆ' ? 'text-gray-800' : 'text-white'}">${y.gan_kor}</span>
                    <span class="absolute bottom-0.5 right-1 text-[9px] font-medium ${y.gan_elem === 'ê¸ˆ' ? 'text-gray-400' : 'text-white/70'}">${y.ganzi[0]}</span>
                </div>
                <div class="relative w-full aspect-square rounded-lg flex items-center justify-center shadow-sm border border-black/5 bg-${y.ji_elem} ${y.ji_elem === 'ê¸ˆ' ? 'border-gray-200' : ''}">
                    <span class="text-[19px] font-bold ${y.ji_elem === 'ê¸ˆ' ? 'text-gray-800' : 'text-white'}">${y.ji_kor}</span>
                    <span class="absolute bottom-0.5 right-1 text-[9px] font-medium ${y.ji_elem === 'ê¸ˆ' ? 'text-gray-400' : 'text-white/70'}">${y.ganzi[1]}</span>
                </div>
            </div>
            <div class="mt-2.5 text-center flex flex-col gap-0.5 leading-tight">
                <div class="text-[10px] text-gray-500 font-medium">${y.t_ji}</div>
                <div class="text-[10px] text-gray-400">${y.unseong}</div>
            </div>
        </div>
    `).join('');
}
async function loadWolun(targetYear, meGan, meHj, element) {
    // 1. ì—°ìš´ ë°•ìŠ¤ ì„ íƒ ê°•ì¡° (ê¸°ì¡´ ë³´ë” ì œê±° í›„ ì¶”ê°€)
    document.querySelectorAll('.yeonun-item-box .ganzi-container').forEach(box => {
        box.classList.remove('ring-2', 'ring-gray-800', 'ring-offset-1');
    });
    const targetBox = element.querySelector('.ganzi-container');
    if (targetBox) targetBox.classList.add('ring-2', 'ring-gray-800', 'ring-offset-1');

    try {
        // 2. ì›”ìš´ API í˜¸ì¶œ
        const url = `/api/wolun?target_year=${targetYear}&me_gan=${meGan}&me_hj=${meHj}`;
        const response = await fetch(url);
        const data = await response.json();

        // 3. ì›”ìš´ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        renderWolunList(data);
    } catch (error) {
        console.error("ì›”ìš´ ë¡œë“œ ì‹¤íŒ¨:", error);
    }
}

function renderWolunList(data) {
    const container = document.getElementById('wolun-container');
    const currentMonth = new Date().getMonth() + 1; // í˜„ì¬ ì–‘ë ¥ ì›” (1~12)

    container.innerHTML = data.map(w => {
        // í˜„ì¬ ë‹¬ì´ë©´ ê°•ì¡° í…Œë‘ë¦¬ í´ë˜ìŠ¤ ì¶”ê°€
        const isCurrent = (w.month === currentMonth) ? 'ring-2 ring-indigo-500 ring-offset-1' : '';
        
        return `
            <div class="flex-shrink-0 w-[58px] flex flex-col items-center">
                <div class="text-[12px] font-bold ${w.month === currentMonth ? 'text-indigo-600' : 'text-gray-600'} mb-1">${w.month}ì›”</div>
                <div class="text-[10px] text-gray-500 mb-2 h-4">${w.t_gan}</div>
                <div class="ganzi-container w-full flex flex-col gap-1.5 rounded-lg transition-all ${isCurrent}">
                    <div class="relative w-full aspect-square rounded-lg flex items-center justify-center shadow-sm bg-${w.gan_elem} ${w.gan_elem === 'ê¸ˆ' ? 'border border-gray-200' : ''}">
                        <span class="text-[19px] font-bold ${w.gan_elem === 'ê¸ˆ' ? 'text-gray-800' : 'text-white'}">${w.gan_kor}</span>
                        <span class="absolute bottom-0.5 right-1 text-[9px] font-medium ${w.gan_elem === 'ê¸ˆ' ? 'text-gray-400' : 'text-white/70'}">${w.ganzi[0]}</span>
                    </div>
                    <div class="relative w-full aspect-square rounded-lg flex items-center justify-center shadow-sm bg-${w.ji_elem} ${w.ji_elem === 'ê¸ˆ' ? 'border border-gray-200' : ''}">
                        <span class="text-[19px] font-bold ${w.ji_elem === 'ê¸ˆ' ? 'text-gray-800' : 'text-white'}">${w.ji_kor}</span>
                        <span class="absolute bottom-0.5 right-1 text-[9px] font-medium ${w.ji_elem === 'ê¸ˆ' ? 'text-gray-400' : 'text-white/70'}">${w.ganzi[1]}</span>
                    </div>
                </div>
                <div class="mt-2.5 text-center leading-tight">
                    <div class="text-[10px] text-gray-500 font-medium">${w.t_ji}</div>
                    <div class="text-[10px] text-gray-400">${w.unseong}</div>
                </div>
            </div>
        `;
    }).join('');

    // í˜„ì¬ ë‹¬ì´ ìˆëŠ” ê³³ìœ¼ë¡œ ìŠ¤í¬ë¡¤ ìë™ ì´ë™
    const activeItem = container.querySelector('.ring-indigo-500');
    // if (activeItem) {
    // //    activeItem.parentElement.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
    // }
}    // ì´ˆê¸°í™”

const today = new Date();
// 1. ì´ˆê¸° ë³€ìˆ˜ ì„¤ì •: ì„œë²„ì—ì„œ ë„˜ê²¨ì¤€ í˜„ì¬ ì—°/ì›”ë¡œ ì‹œì‘ (í•˜ë“œì½”ë”© ë°©ì§€)
let currentCalYear = {{ result.now_year | default(2026) }};
let currentCalMonth = {{ result.now_month | default(1) }};

/**
 * ë‹¬ë ¥ ë Œë”ë§ í•¨ìˆ˜
 */
function renderCalendar(data, year, month) {
    const grid = document.getElementById('calendar-grid');
    if (!grid) return;

    // [ìˆ˜ì •] ì–‘ë ¥ í—¤ë” ì—…ë°ì´íŠ¸
// [ìˆ˜ì •] í…ìŠ¤íŠ¸ê°€ ì•„ë‹Œ select ë°•ìŠ¤ì˜ valueë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
    document.getElementById('cal-year-select').value = year;
    document.getElementById('cal-month-select').value = month;
    // [ì¶”ê°€] ì‚¬ì£¼ ì—°ë„ ë° ì›” ë²”ìœ„(ì˜ˆ: ì„ì‚¬ë…„ ë¬´ì~ê¸°ì¶•ì›”) ì—…ë°ì´íŠ¸
    const sajuHeader = document.getElementById('cal-saju-header');
    if (sajuHeader && data.saju_header) {
        sajuHeader.innerText = data.saju_header;
    }

    grid.innerHTML = '';

    // 1. ì‹œì‘ ìš”ì¼ ê³µë°± ìƒì„±
    for (let i = 0; i < data.first_weekday; i++) {
        grid.innerHTML += `<div class="p-2"></div>`;
    }

    // 2. ë‚ ì§œ ë°•ìŠ¤ ìƒì„± (ë””ìì¸ ë° ìƒ‰ìƒ ì²˜ë¦¬)
    data.days.forEach(d => {
        const isSun = (data.first_weekday + d.day - 1) % 7 === 0;
        const isSat = (data.first_weekday + d.day - 1) % 7 === 6;
        
        grid.innerHTML += `
            <div class="relative p-2 h-24 border border-gray-50 rounded-lg flex flex-col bg-gray-50/30 ${d.is_today ? 'ring-2 ring-gray-800 bg-white z-10' : ''}">
                <span class="text-[11px] font-bold ${isSun ? 'text-red-500' : isSat ? 'text-blue-500' : 'text-gray-700'}">${d.day}</span>
                <div class="mt-1 flex flex-col leading-tight">
                    <span class="text-[10px] font-bold text-gray-800">
                        ${d.ganzi_kor} <span class="text-[8px] font-normal opacity-40">${d.ganzi_hj}</span>
                    </span>
                    <span class="text-[9px] text-gray-400">${d.lunar}</span>
                </div>
                ${d.term_name ? `
                    <div class="mt-auto text-[9px] text-red-500 font-bold leading-tight">
                        ${d.term_name}<br>${d.term_time}
                    </div>
                ` : ''}
            </div>
        `;
    });
}

/**
 * ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
 */
async function fetchCalendarData(year, month) {
    try {
        const response = await fetch(`/api/calendar?year=${year}&month=${month}`);
        if (!response.ok) throw new Error('ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ì—ëŸ¬');
        const data = await response.json();
        
        // ë°ì´í„° ë¡œë“œ í›„ ë Œë”ë§ í•¨ìˆ˜ í˜¸ì¶œ
        renderCalendar(data, year, month);
    } catch (e) {
        console.error("ë‹¬ë ¥ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤:", e);
    }
}

/**
 * ì›” ë³€ê²½ í•¨ìˆ˜
 */
function changeMonth(offset) {
    currentCalMonth += offset;
    if (currentCalMonth > 12) { 
        currentCalYear++; 
        currentCalMonth = 1; 
    } else if (currentCalMonth < 1) { 
        currentCalYear--; 
        currentCalMonth = 12; 
    }
    fetchCalendarData(currentCalYear, currentCalMonth);
}
function initYearSelect() {
    const yearSelect = document.getElementById('cal-year-select');
    if (!yearSelect) return;
    
    let options = "";
    for (let y = 1900; y <= 2100; y++) {
        options += `<option value="${y}">${y}</option>`;
    }
    yearSelect.innerHTML = options;
}

// 1. ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì „ì—­ ë³€ìˆ˜ë¡œ ê´€ë¦¬í•˜ì—¬ ì–´ë””ì„œë“  ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.
let elementChart = null;
let tengodChart = null;

/**
 * í˜ì´ì§€ ë¡œë“œ ì‹œ ì°¨íŠ¸ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
 */
function initCharts() {
    const commonOptions = {
        responsive: true,
        maintainAspectRatio: true,
        plugins: { legend: { display: false }, tooltip: { enabled: false }, datalabels: { display: false } },
        cutout: '78%',
        animation: { animateScale: true, animateRotate: true }
    };

    // --- 1. ì˜¤í–‰ ì°¨íŠ¸ ì´ˆê¸°í™” ---
    const elCanvas = document.getElementById('elementDoughnutChart');
    if (elCanvas) {
        // [í•„ì‚´ê¸°] í•´ë‹¹ ìº”ë²„ìŠ¤ì— ì´ë¯¸ ê·¸ë ¤ì§„ ì°¨íŠ¸ê°€ ìˆëŠ”ì§€ Chart.jsì—ê²Œ ì§ì ‘ ë¬¼ì–´ë´…ë‹ˆë‹¤.
        const existingChart = Chart.getChart(elCanvas); 
        if (existingChart) {
            existingChart.destroy(); // ì¡´ì¬í•œë‹¤ë©´ ë¬´ì¡°ê±´ íŒŒê´´
        }
        
        elementChart = new Chart(elCanvas, {
            type: 'doughnut',
            data: {
                labels: ['ëª©', 'í™”', 'í† ', 'ê¸ˆ', 'ìˆ˜'],
                datasets: [{
                    data: [{{ result.scores['ëª©'] }}, {{ result.scores['í™”'] }}, {{ result.scores['í† '] }}, {{ result.scores['ê¸ˆ'] }}, {{ result.scores['ìˆ˜'] }}],
                    backgroundColor: ['#16a34a', '#dc2626', '#a16207', '#6b7280', '#2563eb'],
                    borderWidth: 0
                }]
            },
            options: commonOptions
        });
    }

    // --- 2. ì‹­ì„± ì°¨íŠ¸ ì´ˆê¸°í™” ---
    const tgCanvas = document.getElementById('tengodDoughnutChart');
    if (tgCanvas) {
        // [í•„ì‚´ê¸°] ì‹­ì„± ì°¨íŠ¸ë„ ë™ì¼í•˜ê²Œ ìº”ë²„ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ íŒŒê´´ ì²´í¬
        const existingTgChart = Chart.getChart(tgCanvas);
        if (existingTgChart) {
            existingTgChart.destroy();
        }

        const tgOrder = ["ë¹„ê²¬", "ê²ì¬", "ì‹ì‹ ", "ìƒê´€", "í¸ì¬", "ì •ì¬", "í¸ê´€", "ì •ê´€", "í¸ì¸", "ì •ì¸"];
        const tgData = {{ result.tengod_analysis | tojson }};
        const tgValues = tgOrder.map(name => {
            const found = tgData.find(d => d.name === name);
            return found ? parseFloat(found.ratio.replace('%', '')) : 0;
        });
        
        tengodChart = new Chart(tgCanvas, {
            type: 'doughnut',
            data: {
                labels: tgOrder,
                datasets: [{
                    data: tgValues,
                    backgroundColor: ['#4ade80', '#22c55e', '#f87171', '#ef4444', '#facc15', '#eab308', '#9ca3af', '#6b7280', '#60a5fa', '#3b82f6'],
                    borderWidth: 0
                }]
            },
            options: commonOptions
        });
    }
}/**
 * ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì‹œ í˜¸ì¶œë˜ëŠ” ë¹„ë™ê¸° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
 */
async function updateAnalysis() {
    // 1. ì²´í¬ë°•ìŠ¤ ìƒíƒœ í™•ì¸
    const useHap = document.getElementById('hap-check').checked;
    const useJohoo = document.getElementById('johoo-check').checked;
    
    // 2. ë¶„ì„ìš© ê¸°ë³¸ íŒŒë¼ë¯¸í„° (í…œí”Œë¦¿ ë³€ìˆ˜ì—ì„œ ê°€ì ¸ì˜´)
    const params = new URLSearchParams({
        birth: "{{ result.birth }}",
        gender: "{{ result.gender }}",
        location: "{{ result.location_name }}",
        use_hap: useHap,
        use_johoo: useJohoo
    });

    try {
        const response = await fetch(`/api/re-analyze?${params.toString()}`);
        const data = await response.json();
        
        console.log("ì„œë²„ ì‘ë‹µ ë°ì´í„°:", data); // [ë””ë²„ê·¸] ë°ì´í„°ê°€ ì˜ ì˜¤ëŠ”ì§€ í™•ì¸

        if (data.error) {
            console.error("ì„œë²„ ì—ëŸ¬ ë°œìƒ:", data.error);
            return;
        }

        // --- 3. ì˜¤í–‰ ê·¸ë˜í”„ ì—…ë°ì´íŠ¸ ---
        // ì „ì—­ ë³€ìˆ˜ê°€ ë¹„ì—ˆì„ ê²½ìš° ìº”ë²„ìŠ¤ì—ì„œ ì§ì ‘ ì°¨íŠ¸ë¥¼ ì°¾ì•„ì˜µë‹ˆë‹¤.
        if (!elementChart) elementChart = Chart.getChart("elementDoughnutChart");
        
        if (elementChart && data.scores) {
            elementChart.data.datasets[0].data = ['ëª©', 'í™”', 'í† ', 'ê¸ˆ', 'ìˆ˜'].map(l => data.scores[l] || 0);
            elementChart.update();
        } else {
            console.warn("ì˜¤í–‰ ì°¨íŠ¸ ê°ì²´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
        }

        // --- 4. ì‹­ì„± ê·¸ë˜í”„ ì—…ë°ì´íŠ¸ ---
        if (!tengodChart) tengodChart = Chart.getChart("tengodDoughnutChart");
        
        if (tengodChart && data.tengod_counts) {
            const tgOrder = ["ë¹„ê²¬", "ê²ì¬", "ì‹ì‹ ", "ìƒê´€", "í¸ì¬", "ì •ì¬", "í¸ê´€", "ì •ê´€", "í¸ì¸", "ì •ì¸"];
            tengodChart.data.datasets[0].data = tgOrder.map(l => data.tengod_counts[l] || 0);
            tengodChart.update();
        }

        // --- 5. ìƒì„¸ í…Œì´ë¸”(Forestellar) ì—…ë°ì´íŠ¸ ---
        // í…Œì´ë¸”ì„ ê°ì‹¸ê³  ìˆëŠ” ì •í™•í•œ ì»¨í…Œì´ë„ˆë¥¼ ì°¾ìŠµë‹ˆë‹¤.
        const tableContainer = document.querySelector('section.my-12 .bg-white.rounded-xl.shadow-sm .divide-y');
        
        if (tableContainer && data.forestellar_analysis) {
            tableContainer.innerHTML = data.forestellar_analysis.map(row => `
                <div class="grid grid-cols-2">
                    <div class="p-4 border-r border-gray-100 flex flex-col justify-center items-center">
                        <div class="text-base font-bold mb-1 text-${getElementColorClass(row.elem_name)}">${row.elem_name}</div>
                        <div class="text-xs text-gray-500">${row.score} <span class="px-1.5 py-0.5 rounded-md bg-gray-100 text-[10px]">${row.status}</span></div>
                    </div>
                    <div class="p-4 flex flex-col justify-center space-y-2 text-xs">
                        <div class="flex justify-between items-center h-5">
                            <span class="text-gray-700">${row.tg1_name}</span>
                            <span class="font-mono text-gray-400">${row.tg1_ratio}</span>
                        </div>
                        <div class="flex justify-between items-center h-5 border-t border-dotted border-gray-200 pt-1">
                            <span class="text-gray-700">${row.tg2_name}</span>
                            <span class="font-mono text-gray-400">${row.tg2_ratio}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        } else {
            console.warn("í…Œì´ë¸” ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. HTML êµ¬ì¡°ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
        }

        // --- 6. ì‹ ê°•ì•½ ë° íœíƒ€ê³¤ ì—…ë°ì´íŠ¸ ---
        updateRelationNodes(data.relation_groups);
        
        const powerStatus = document.getElementById('power-status-text');
        const powerIndicator = document.getElementById('power-indicator');
        if (powerStatus) powerStatus.innerText = `${data.status}(${data.power})`;
        if (powerIndicator) powerIndicator.style.left = `${data.power}%`;

    } catch (e) {
        console.error("ì—…ë°ì´íŠ¸ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜:", e);
    }
}/**
 * ì˜¤í–‰ ê´€ê³„ë„(íœíƒ€ê³¤)ì˜ ë…¸ë“œ ìˆ˜ì¹˜ì™€ ë°°ê²½ ë†’ì´ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
 */
/**
 * ìˆ˜ì •ëœ updateRelationNodes í•¨ìˆ˜
 */
function updateRelationNodes(groups) {
    if (!groups) return;

    groups.forEach((group, idx) => {
        const node = document.querySelector(`.node-pos-${idx}`);
        if (node) {
            // [ìˆ˜ì •] .text-[18px] -> .text-\\[18px\\] ë¡œ ë³€ê²½í•˜ì—¬ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬
            const scoreSpan = node.querySelector('.text-\\[18px\\]');
            if (scoreSpan) scoreSpan.innerText = group.score;

            const bgFill = node.querySelector('.absolute.bottom-0');
            if (bgFill) bgFill.style.height = `${group.percent}%`;
        }
    });
}
/**
 * ì˜¤í–‰ê³¼ ì‹­ì„± ë¶„ì„ ìƒì„¸ í‘œì˜ ë‚´ìš©ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
 */
function updateForestellarTable(analysis) {
    const container = document.querySelector('.divide-y.divide-gray-100');
    if (!container || !analysis) return;

    container.innerHTML = analysis.map(row => `
        <div class="grid grid-cols-2">
            <div class="p-4 border-r border-gray-100 flex flex-col justify-center items-center">
                <div class="text-base font-bold mb-1 text-${getElementColorClass(row.elem_name)}">${row.elem_name}</div>
                <div class="text-xs text-gray-500">${row.score} <span class="px-1.5 py-0.5 rounded-md bg-gray-100 text-[10px]">${row.status}</span></div>
            </div>
            <div class="p-4 flex flex-col justify-center space-y-2 text-xs">
                <div class="flex justify-between items-center h-5"><span class="text-gray-700">${row.tg1_name}</span><span class="text-gray-400">${row.tg1_ratio}</span></div>
                <div class="flex justify-between items-center h-5 border-t border-dotted border-gray-200 pt-1"><span class="text-gray-700">${row.tg2_name}</span><span class="text-gray-400">${row.tg2_ratio}</span></div>
            </div>
        </div>
    `).join('');
}
/**
 * ì˜¤í–‰ ì´ë¦„ì„ ë°›ì•„ í•´ë‹¹í•˜ëŠ” Tailwind CSS ì»¬ëŸ¬ í´ë˜ìŠ¤ ë¬¸ìì—´ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
 */
function getElementColorClass(elem) {
    const colorMap = {
        'ëª©': 'green-600',
        'í™”': 'red-600',
        'í† ': 'yellow-700',
        'ê¸ˆ': 'gray-500',
        'ìˆ˜': 'blue-600'
    };
    // ë§¤ì¹­ë˜ëŠ” ì˜¤í–‰ì´ ì—†ì„ ê²½ìš° ê¸°ë³¸ê°’ìœ¼ë¡œ gray-500ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
    return colorMap[elem] || 'gray-500';
}
/**
 * [ì¶”ê°€] select ë°•ìŠ¤ ê°’ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
 */
function handleDateSelect() {
    currentCalYear = parseInt(document.getElementById('cal-year-select').value);
    currentCalMonth = parseInt(document.getElementById('cal-month-select').value);
    
    fetchCalendarData(currentCalYear, currentCalMonth);
}
  
    window.onload = () => highlightInteraction('ê¶ì„±');
    window.addEventListener('DOMContentLoaded', () => {
        // 1. í˜„ì¬ ëŒ€ìš´ í•˜ì´ë¼ì´íŠ¸ (ê¸°ì¡´ ì½”ë“œ)
        const currentDaeunBox = document.querySelector('.is-current-daeun');
        if (currentDaeunBox) {
            const targetContainer = currentDaeunBox.querySelector('.ganzi-container');
            if (targetContainer) {
                targetContainer.classList.add('ring-2', 'ring-gray-800', 'ring-offset-1');
            }
          //  currentDaeunBox.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
        }

    // 2. [ì¶”ê°€] ì´ˆê¸° ì—°ìš´ ì¤‘ í˜„ì¬ ì—°ë„(ì˜ˆ: 2026) ë°•ìŠ¤ í•˜ì´ë¼ì´íŠ¸
    const currentYear = new Date().getFullYear();
    const yeonunBoxes = document.querySelectorAll('#yeonun-container .yeonun-item-box');
    yeonunBoxes.forEach(box => {
        const yearText = box.querySelector('div').innerText; // ì—°ë„ í…ìŠ¤íŠ¸ ì¶”ì¶œ
        if (yearText == currentYear) {
            const container = box.querySelector('.ganzi-container');
            if (container) container.classList.add('ring-2', 'ring-gray-800', 'ring-offset-1');
       //     box.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
        }
    });
    initYearSelect();
    
    // 2. ì´ˆê¸° ë‹¬ë ¥ ë°ì´í„° ë¡œë“œ
    fetchCalendarData(currentCalYear, currentCalMonth);
 // ì´ˆê¸° ë¡œë“œ ì‹œ ì„œë²„ì—ì„œ ë„˜ê²¨ì¤€ ê°’ì´ë‚˜ JSì˜ ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ì‚¬ìš©í•˜ì—¬ í˜¸ì¶œ
    fetchCalendarData(currentCalYear, currentCalMonth);
    initCharts();
    highlightInteraction('ê¶ì„±');
});
</script>
</html>